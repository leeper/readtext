---
title: "Using the readtext package"
author: "Kenneth Benoit"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: yes
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, 
                      comment = "##")
```

## Introduction

The **readtext** package is designed to make loading texts extremely easy, using a single command.  It is also designed to work seamlessly with the [**quanteda**](http://kbenoit.github.io/quanteda) package for text analysis.  

We will work with some files that are distributed with the **readtext** package.  This will set their location properly for your system:
```{r}
require(readtext)
DATA_DIR <- system.file("extdata/", package = "readtext")
```

## Reading in simple text files

Here we will work with a variety of files that come from the political manifestos of two party groups (the Party of European Socialists and the Greens) from the European Parliament, saved in different languages.  

```{r}
list.files(paste0(DATA_DIR, "txt/EU_manifestos/"))
```
We can read in these files using the "glob" style wildcard character `*`, which is a standard pattern matching scheme used for matching files in operating systems.

```{r}
data_readtext_EU <- readtext(paste0(DATA_DIR, "txt/EU_manifestos/*.txt"), verbosity = 0)
```
This results in a "readtext"-classed data.frame object, whose first (and in this case, only) column is named `text`.  
```{r}
str(data_readtext_EU)
```

This does not really look right, however.  We can verify this by attempting to inspect the first 200 characters of the first file, as read in:
```{r}
stringi::stri_sub(data_readtext_EU$text[1], 1, 200)
```

That clearly does not look right -- some characters were not read correctly.

The problem here is one of *encoding*: these files are encoded in Latin-1, not UTF-8 as **readtext** expects by default.  We can diagnose this using the `encoding()` function:

```{r}
encoding(data_readtext_EU)
```

An even more reliable method is to use the `file` utility from a command prompt.  (This is a venerable Unix utility available by default on macOS and Linux, and through [RTools](https://cran.r-project.org/bin/windows/Rtools/) if you have installed this on Windows.)

```{r}
# calls the shell utility file and saves the output to an R object
filelist <- system2("file", paste0(DATA_DIR, "txt/EU_manifestos/*.txt"), stdout = TRUE)
# to tidy up the output listing
stringi::stri_replace_all_fixed(filelist, DATA_DIR, "")
```


Here we can see that nearly all of these are "ISO-8859" format, another way of describing the "Latin-1" 8-bit character encoding format.  To read the files in correctly, we need to use the `encoding` argument to `readtext`.

```{r, eval = FALSE}
data_readtext_EU <- readtext(paste0(DATA_DIR, "txt/EU_manifestos/*.txt"), encoding = "ISO-8859", verbosity = 0)
```
